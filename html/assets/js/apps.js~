/**
 *
 *
 *
 *
 */
 
var Apps = {

    init: function() {
    
        // List
        var options = {
            item: '<li><div class="image"><img src="assets/img/pixel.gif" class="lazy"></div><div class="text"><div class="name"></div><div class="comment"></div><div class="subcategory"></div><div class="icon hie"></div></div></li>',
            page: 3000
        };

        // Categories
        $("aside a").click(function(e){
            var category = $(this).attr('href').substr(1);
	    var search = $("#search").val();
            $("aside li").removeClass("active");
            $(this).parent("li").addClass("active");
            Apps.filter(category, search);
            scroll(1,1)
            //e.preventDefault();
        });
        
        // Fetch data and init list
        $.getJSON('../data/packages.json', function(json) {  
            Apps.appList = new List('app-list', options, json);
            // Icon lazy loading
	    $("#list li .icon").each(function(index){
                var src = "../data/icons/" + $(this).text();
		$(this).closest("li").find("img").data("original",src);
		        
            });
    	    $("img.lazy").lazyload({ 
                effect : "fadeIn",
                threshold : 300
            });
	$("#loading").hide();
	        
	});
        
        // Click list item
        ich.addTemplate('info', $("#tpl-info").html());
        
        $("body").on("click", "#list > li", function() {
            var pkg = $(this).find(".package").text();
            var $this = $(this);	
            $(this).addClass('loading');
            // remove previous panel
            $("#list > li .panel").remove();
            // load panel
            $.getJSON("../data/packages/" + pkg + ".json" , function(json) {
                var html = ich.info(json);
                $this.append(html);
                $this.removeClass('loading');
            });
        });  
        

        
       
            // list
            
            
            
        
    },
    
    filter: function(category, search) {
        alert(search);
        if(category=='all') {
            Apps.appList.filter();
            return true;
        }
        Apps.appList.filter(function(item){
	    if(item.values().name==search) {
		return true;
	    } else {
	    	return false;
            }
            if(item.values().category==category) {
                return true;
            } else {
                return false;
            }
        });
    }

};


